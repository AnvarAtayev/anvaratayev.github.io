<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns="http://www.w3.org/1999/xhtml" xmlns:x="https://www.texmacs.org/2002/extensions">
  <head>
    <title>No title</title>
    <meta content="TeXmacs 1.99.21" name="generator"></meta>
    <style type="text/css">
      body { text-align: justify } h5 { display: inline; padding-right: 1em }
      h6 { display: inline; padding-right: 1em } table { border-collapse:
      collapse } td { padding: 0.2em; vertical-align: baseline } dt { float:
      left; min-width: 1.75em; text-align: right; padding-right: 0.75em;
      font-weight: bold; } dd { margin-left: 2.75em; padding-bottom: 0.25em; }
      dd p { padding-top: 0em; } .subsup { display: inline; vertical-align:
      -0.2em } .subsup td { padding: 0px; text-align: left} .fraction {
      display: inline; vertical-align: -0.8em } .fraction td { padding: 0px;
      text-align: center } .wide { position: relative; margin-left: -0.4em }
      .accent { position: relative; margin-left: -0.4em; top: -0.1em }
      .title-block { width: 100%; text-align: center } .title-block p {
      margin: 0px } .compact-block p { margin-top: 0px; margin-bottom: 0px }
      .left-tab { text-align: left } .center-tab { text-align: center }
      .balloon-anchor { border-bottom: 1px dotted #000000; outline: none;
      cursor: help; position: relative; } .balloon-anchor [hidden] {
      margin-left: -999em; position: absolute; display: none; }
      .balloon-anchor: hover [hidden] { position: absolute; left: 1em; top:
      2em; z-index: 99; margin-left: 0; width: 500px; display: inline-block; }
      .balloon-body { } .ornament { border-width: 1px; border-style: solid;
      border-color: black; display: inline-block; padding: 0.2em; } .right-tab
      { float: right; position: relative; top: -1em; } .no-breaks {
      white-space: nowrap; } 
    </style>
    <link href="../resources/notes-base.css" type="text/css" rel="stylesheet"></link>
  </head>
  <body>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      This post is a part of a series of  graphics in TeXmacs. Other posts in
      the same series are <a href="./scheme-graphics.html">Composing TeXmacs graphics with Scheme</a>
      and <a href="./scheme-graphics-embedding.html">Embedding graphics composed with Scheme into documents</a>;
      we also plan to write a post on how to generate  graphics with external
      files.
    </p>
    <p>
      Like in the other posts of the series, we assume that the reader is
      familiar with simple Scheme syntax. We link again to the  book <a href="https://en.wikibooks.org/wiki/Scheme_Programming">Scheme
      programming</a> and to <a href="http://www.shido.info/lisp/idx_scm_e.html">Yet Another Scheme Tutorial</a> by
      Takafumi Shido as two possible web resources for learning .
    </p>
    <p>
      TeXmacs graphics provide a set of elementary objects (points, polylines,
      splines and so on). It would be nice to have at hand functions to deal
      with complex objects, which can be seen as unions of elementary objects:
      for example,  a triangle in a half-circle is the union of a polyline (to
      represent the triangle) with the half-circle, which in turn is the union
      of a polyline (the diameter of the half-circle) and an arc.
    </p>
    <p>
      We would like to name complex objects and to transform them as units:
      for example translate them or change the line style or the color for all
      of the object components; naming complex objects will make our code
      clearer when we deal with them&mdash;and for example we use them as
      building blocks of even more complex objects.
    </p>
    <p>
      In TeXmacs there is a partially-implemented interface for dealing with
      complex graphics objects  (see  and the <tt class="verbatim">.scm</tt> files in
      the <tt class="verbatim">progs/graphics/</tt> directory in the TeXmacs
      distribution). In particular, graphics can be grouped using the
      primitive .
    </p>
    <p>
      In this post, we will develop a small interface of our own; we will show
      how to compose and use in a drawing complex graphical objects, how to
      shift them and how to set properties of already-existing complex
      objects.
    </p>
    <p>
      
    </p>
    <p>
      In , a natural way of composing complex objects is joining the building
      blocks into a list. To get TeXmacs to draw the objects represented by
      our (possibly nested) lists, we need to transform them into lists that
      conform to the TeXmacs graphical input.
    </p>
    <p>
      The input for graphics in TeXmacs  is a list which starts with the
      symbol , whose elements are elementary graphical objects. Each
      elementary graphical object is a list, which starts with one of these
      symbols: , , , , , , , , , , and can be optionally wrapped in a list
      starting with the symbol  that sets properties.
    </p>
    <p>
      One possible way to turn an arbitrarily nested list of elementary
      objects (a complex object, that is) into the flat list of lists that
      TeXmacs expects is flattening it recursively, stopping the recursive
      flattening every time we find one of the symbols that indicate the start
      of a graphical object (including the symbol ).
    </p>
    <p>
      The following group of three functions does that. The main function is
      adapted from <a href="https://stackoverflow.com/a/33338401">one of the answers</a> to this <a href="https://stackoverflow.com/questions/33338078/flattening-a-list-in-scheme">Stack
      Overflow question</a>.
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      Let us define a function for generating points, and use that to define
      some graphical objects (the same objects of our previous posts). We will
      then combine these objects in a complex unit and show that TeXmacs draws
      it using our  function.
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      Let us join graphical objects as lists to form complex graphical
      objects. We will use the conditional flattening inside the graphical
      list to express our complex objects in the way TeXmacs expects them.
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      To write less ourselves, we can define a function that flattens graphics
      lists and wraps them with the TeXmacs syntax:
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      We would like to manipulate complex objects as units. Let's see how to
      translate them; one can in a similar way rotate and stretch them
      (perhaps with respect to reference points which are calculated from the
      objects themselves). We will then see how to apply properties to all of
      the components of an object.
    </p>
    <p>
      
    </p>
    <p>
      Since all objects are made out of points (that is, lists that start with
      the symbol ), we need to translate each point which the list is composed
      of.
    </p>
    <p>
      We do it by mapping a translation function recursively onto the list
      that represents a complex object; in this recursive mapping we
      distinguish between expressions that represent points (that have to be
      translated) and expressions that represent something else (that have to
      be left as they are).
    </p>
    <p>
      The distinction is made when the recursion either gets to a point or
      gets to an atom: if it does get to an atom, then the translation
      function acts as the identity function. Here is the algorithm applied to
      a list:
    </p>
    <ul>
      <li>
        <p>
          If the list starts with , we apply the function that translates the
          point
        </p>
      </li>
      <li>
        <p>
          If the list does not start with , we map the translation function
          onto the list
        </p>
      </li>
      <li>
        <p>
          If while mapping we meet an atom, we leave it as it is
        </p>
      </li>
    </ul>
    <p>
      
    </p>
    <p>
      Let us now use our translation function on a complex object in a
      drawing: the triangle inscribed in the half-circle we first drew by
      listing all of the elementary objects and then by combining the complex
      ,  and  objects (we are then going to add the TeXmacs caption!).
    </p>
    <p>
      This time, we define the whole drawing as a unit, calling it ; we will
      need to remember to unquote the symbol  when placing it inside lists
      defined through quasiquoting.
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      We write a simple function which wraps each elementary object in a ,
      placing it inside with respect to any other  construct the object might
      be already placed in. This function, applied a few times, generates
      deeply nested lists that may be difficult to read; a more refined
      function would check if the object is already inside a  construct and if
      it is, modify the  list rather than adding another one. We prefer the
      simple function to the refined one to keep this post to the point
      (&ldquo;modular graphics&rdquo;).
    </p>
    <p>
      The  needs to be placed as innermost wrapping construct for each element
      so that the new property will prevail onto pre-existing properties (s
      are scoping constructs).
    </p>
    <p>
      The  function is built with the same logic as the  function. When
      applied to a list, it first checks if the list starts with one of the
      &ldquo;graphical object&rdquo; symbols; if it does,  wraps it in a 
      construct; if it does not,  maps itself onto the list elements. When
      applied to an atom,  returns the input.
    </p>
    <p>
      In this way the function seeks recursively inside the lists of all the
      graphical objects, and applies the desired property to each.
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      We apply again the idea of modularity by assigning to a variable the
      object which we obtain after translation and application of dashing, and
      using the variable to build a drawing. Our code again shows that in 
      building blocks combine together well.
    </p>
    <p>
      
    </p>
    <p>
      We can play further. Let's blend the triangle inside the half-circle
      stepwise. Our functions are not sophisticated enough to target a subunit
      of a complex object: applying a line-width to the whole drawing of the
      triangle in the half-circle would eliminate the different line-widths
      for the triangle and arc; for this reason, we use as an example of
      blending in the triangle alone, which is one of the units we defined.
    </p>
    <p>
      
    </p>
    <p>
      One could wish for more actions. For example, one could wish to find
      intersections of lines which define objects, and assign them to new
      objects. Another example is to define styles as shortcuts to set several
      properties of a graphical object with a single operation; this is among
      the functions in the yet-to-be completed TeXmacs  graphics code.  is
      promising for implementing each of them.
    </p>
    <p>
      As a sketch of an implementation, styles could be defined as lists of
      name-value pairs, maybe association lists (this might allow easier
      error-checking), which can be inserted into  constructs by a function
      which first flattens the pairs then appends the resulting list into a 
      list at the position we indicated with the dots to apply all of the
      properties to . Never mind that the  syntax to achieve what we want is
      slightly different from the description I gave, it is close enough that
      I hope it is convincing.
    </p>
    <p>
      About persuasion. I hope that I convinced you that the initial effort of
      setting up  functions pays off: one constructs a powerful graphical
      language in which arbitrarily complex graphics are treated uniformly.
    </p>
  </body>
</html>